(window.webpackJsonp=window.webpackJsonp||[]).push([[164],{"5v+H":function(t,i,e){"use strict";e.r(i);var a=function(){var t=this,i=t._self._c;return i("vue-perfect-scrollbar",{staticClass:"h-100 rtl-ps-none ps scroll",staticStyle:{height:"100%"},attrs:{settings:{suppressScrollX:!0,wheelPropagation:!1}}},[i("div",{staticClass:"pa-5 relative mb-5"},[i("v-app-bar",{staticClass:"pt-1",attrs:{fixed:"",flat:""}},[i("div",{staticClass:"d-flex justify-space-between align-center w-full"},[i("h6",{staticClass:"ma-0"},[t._v("Notifications")]),t._v(" "),t._t("notificationDrawerCloseButton")],2),t._v(" "),i("v-progress-linear",{attrs:{active:t.showNotificationSpinner,indeterminate:t.showNotificationSpinner,absolute:"",bottom:"",color:"primary"}})],1)],1),t._v(" "),i("v-list",{attrs:{"three-line":""}},[t._l(t.items,(function(e,a){return[a>0?i("v-divider"):t._e(),t._v(" "),i("v-menu",{key:e.created,attrs:{"max-width":"500","open-on-hover":"",left:"","offset-x":!0},scopedSlots:t._u([{key:"activator",fn:function(a){var n=a.on,o=a.attrs;return[i("v-list-item",t._g(t._b({key:e.created},"v-list-item",o,!1),n),[i("v-list-item-avatar",[e.photoUrl?i("v-img",{attrs:{src:t.formatPhotoUrl(e.photoUrl),alt:e.photoText}}):t._e()],1),t._v(" "),i("v-list-item-content",[i("v-list-item-title",[e.notificationText?i("span",{directives:[{name:"markdown",rawName:"v-markdown",value:e.notificationText,expression:"item.notificationText"}]}):t._e()]),t._v(" "),e.articleText?i("v-list-item-subtitle",{staticClass:"mb-2"},[i("span",{directives:[{name:"markup",rawName:"v-markup",value:e.articleText,expression:"item.articleText"}]})]):t._e(),t._v(" "),i("v-list-item-subtitle",[i("div",[t._v(t._s(t._f("formatDateToNow")(1e3*e.created,"MMM d")))])])],1),t._v(" "),i("v-list-item-action",[i("v-btn",{attrs:{icon:"",color:"accent"},on:{click:function(i){return t.deleteItem(e.created)}}},[i("v-icon",{attrs:{dark:""}},[t._v("\n                  mdi-delete-forever\n                ")])],1)],1)],1)]}}],null,!0)},[t._v(" "),i("v-card",[i("v-card-text",[e.notificationText?i("div",{directives:[{name:"markdown",rawName:"v-markdown",value:e.notificationText,expression:"item.notificationText"}],staticClass:"mb-2",class:t.$vuetify.theme.dark?"white--text":"primary--text darken-2"}):t._e(),t._v(" "),e.articleText?i("div",{directives:[{name:"markup",rawName:"v-markup",value:e.articleText,expression:"item.articleText"}],staticClass:"mb-2"}):t._e(),t._v(" "),e.articleTitle?i("div",[i("v-divider",{staticClass:"my-3"}),t._v(" "),i("span",{directives:[{name:"markup",rawName:"v-markup",value:e.articleTitle,expression:"item.articleTitle"}]}),t._v(" (#"+t._s(e.articleId)+")\n            ")],1):t._e()]),t._v(" "),e.notificationLink?i("v-card-actions",[i("v-spacer"),t._v(" "),i("v-btn",{attrs:{color:"primary",outlined:"",href:e.notificationLink}},[t._v("\n              View\n            ")])],1):t._e()],1)],1)]}))],2)],1)};a._withStripped=!0;var n=e("vDqi"),o=e.n(n),s=e("bbSu"),r=e("dwWe"),c={name:"NotificationDrawer",props:{isOpen:{type:Boolean,required:!1}},onIdle:function(){this.closeMercureSubscriber()},onActive:function(){this.resumeMercureSubscriber()},beforeDestroy:function(){s.a.$off("peerj_evs_notification")},beforeMount:function(){s.a.$off("peerj_evs_notification")},mounted:function(){s.a.$on("peerj_evs_notification",this.notificationEventReceived),this.setupMercureSubscription("/notifications/subscribe","notification")},computed:{totalCount:function(){var t;return null!==(t=this.paginationData.totalCount)&&void 0!==t?t:this.items.length},numItemsPerPage:function(){var t;return null!==(t=this.paginationData.numItemsPerPage)&&void 0!==t?t:null}},data:function(){return{dialog:!1,unreadCount:0,lastRead:null,items:[],paginationData:{},showNotificationSpinner:!1}},watch:{unreadCount:function(){this.$emit("unreadNotificationCount",this.unreadCount)},isOpen:function(t){if(this.unreadCount=0,t){var i=!0;this.lastRead=r.a.getItem("notificationsUpdated"+this.account.id);var e=r.a.getItem("notifications"+this.account.id),a=(new Date).getTime();e&&(this.lastRead&&a-this.lastRead<18e5&&(i=!1),this.items=JSON.parse(e)),this.lastRead&&!i||this.getFeed(!0)}},totalCount:function(){this.totalCount>this.numItemsPerPage&&this.$emit("showNotificationLink",!0)}},methods:{notificationEventReceived:function(t){if(t.userId==this.account.id)if(t.isDeletion)this.removeNotificationByTimeCreated(t.created);else{if(t.updateComponent)return void s.a.$emit("kanban_update_available",t);this.items.unshift(t),this.unreadCount+=1,r.a.getItem("notifications"+this.account.id)?(this.items.sort((function(t,i){return i.created-t.created})),this.storeNotifications(this.items)):this.getFeed(!0)}},getFeed:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];o.a.defaults.url="/feed/notifications",o.a.request({}).then((function(e){t.lastRead=new Date,e.data.items&&(i&&(t.items=[]),e.data.paginationData&&(t.paginationData=e.data.paginationData),e.data.items.forEach((function(i){t.items.push(JSON.parse(i))})),t.storeNotifications(t.items))})).catch((function(t){console.log(t)}))},deleteItem:function(t){var i=this;this.showNotificationSpinner=!0,o.a.defaults.url="/feed/notification/delete/"+t,o.a.request({}).then((function(){i.removeNotificationByTimeCreated(t)})).catch((function(t){console.log(t)})).finally((function(){i.showNotificationSpinner=!1}))},removeNotificationByTimeCreated:function(t){this.items=this.items.filter((function(i){return i.created!==t}))},storeNotifications:function(t){if(t){r.a.setItem("notifications"+this.account.id,JSON.stringify(t));var i=(new Date).getTime();r.a.setItem("notificationsUpdated"+this.account.id,i)}},formatPhotoUrl:function(t){return t.startsWith("http")?t:this.userImagePrefix+t}}},u=e("KHd+"),l=e("ZUTo"),d=e.n(l),f=e("QNyc"),m=e("gzZi"),v=e("sK+t"),p=e("mdmw"),h=e("zn5u"),_=e("Ey0z"),w=e("rdoz"),g=e("iGBT"),b=e("2hOt"),C=e("GADD"),x=e("gnBG"),T=e("XSMC"),N=e("5Emp"),k=e("jjY0"),I=e("L6Q5"),y=Object(u.a)(c,a,[],!1,null,null,null);i.default=y.exports;d()(y,{VAppBar:f.a,VBtn:m.a,VCard:v.a,VCardActions:p.a,VCardText:p.c,VDivider:h.a,VIcon:_.a,VImg:w.a,VList:g.a,VListItem:b.a,VListItemAction:C.a,VListItemAvatar:x.a,VListItemContent:T.a,VListItemSubtitle:T.b,VListItemTitle:T.c,VMenu:N.a,VProgressLinear:k.a,VSpacer:I.a})}}]);